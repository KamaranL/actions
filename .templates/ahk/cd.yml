name: cd

# continuously delivers packaged codebase

on:
  workflow_run:
    workflows: [ci]
    types: completed

concurrency: ${{ github.event_name }}-${{ github.workflow }}
defaults:
  run:
    shell: bash

jobs:
  cd:
    if: github.event.workflow_run.conclusion == 'success'
    runs-on: windows-latest
    timeout-minutes: 3
    env:
      OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.OP_TOKEN }}
    steps:
      - uses: KamaranL/actions/setup/job@v0
        with:
          checkout: |
            fetch-depth=0
            fetch-tags=true

      - uses: KamaranL/actions/setup/cd@v0

      - uses: nukdokplex/autohotkey-build@v1
        with:
          x64: true
          x86: true
          out: ${{ runner.temp }}/.ahk/dist
          icon: file.ico

      - uses: KamaranL/actions/exec/cd/release@v0
        with:
          assets: ${{ runner.temp }}/.ahk/dist
        continue-on-error: true
